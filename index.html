<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>


<script type="text/javascript">
    $(document).ready(function () {
//по умолчаанию дата текущая
        send_request('2017-06-01');
        $('.send_data').click(function () {
                gcw_handlerFDtbXg6kP.reload();
                $('#radio_cl').find(':radio[name=ch_currency][value="Rub"]').prop('checked', true);
                send_request($('#month').val() + '-01');
            }
        )
//смена курса валют
        $('input[type=radio][name=ch_currency]').change(function () {
            var usd_curr = 1;
            var temp_usd_curr = Math.round($('#gcw_valFDtbXg6kP1').val());
            if (this.value === 'Usd') {
                usd_curr = temp_usd_curr;
            }
            else if (this.value === 'Rub') {
                usd_curr = 1 / temp_usd_curr;
            }
            $('#table #salary').each(function () {
                    var temp_sal = $(this).html() / usd_curr;
                    $(this).html(temp_sal);
                }
            )
        })
        $('#close').click(function () {
//новый сотрудник
            var str_new_assoc = $('#name_assoc').val() + ',' + $('#last_name_assoc').val() + ',' + $('#sel_prof').val() + ',' + $('#inp_salary').val() + ',' + $('#avatar').val();
            alert(str_new_assoc);
            $.ajax({
                type: 'GET',
                url: 'index.php',
                data: {'new_assoc': str_new_assoc},
                success: function (result_p) {
                    console.log(result_p);
//                    var parser_res = $.parseJSON(result_p);
//                    $.each(parser_res, function (index, value) {
                    //                       list_opt.append(new Option(value, value));
//                });
        }
    });

    })
    //подгрузка профессий из базы
    $('.button_active').click(function () {
        var list_opt = $('#sel_prof');
        list_opt.empty();
        $.ajax({
            type: 'GET',
            url: 'index.php',
            data: {'prof': 'yes'},
            success: function (result_p) {
                console.log(result_p);
                var parser_res = $.parseJSON(result_p);
                $.each(parser_res, function (index, value) {
                    list_opt.append(new Option(value, value));
                });
            }
        });
    })
    })
    ;
    //выбор месяца
    function send_request(data) {
        $("tr").empty();
        $.ajax({
            type: 'GET',
            url: 'index.php',
            data: {'month': data},
            success: function (result) {
                var html = '<tr></tr><th>Имя</th><th>Фамилия</th><th>Должность</th><th>ЗП</th><th>Бонус</th><th>Фото</th><th>Дата</th></tr>';
                $.each($.parseJSON(result), function (index, element) {
                    html += '<tr><td align="center">' + element.Worker_Name + '</td><td align="center">' + element.Worker_LastName + '</td><td align="center">' + element.Worker_Prof + '</td><td  id="salary" width="5%" align="center">' + element.Salary + '</td><td align="center">' + element.Bonus + '</td><td align="center">' + element.Avatar + '</td><td align="center">' + element.Date_s + '</td></tr>';
                });
                $('#table > tbody').append(html);
            }
        });
    }

</script>


<head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8"/>
    <title>Test WineStyle</title>
    <link rel="stylesheet" href="css/style.css" type="text/css" media="all"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
</head>
<body>

<h1>Вывод зарплат сотрудников</h1>

<table class="table-bordered" id="table">
    <tbody>
    </tbody>
</table>

<p>
    <input type="month" name="month" id="month">
    <input type="submit" value="Показать за месяц" class="send_data">
</p>


<form action="#openModal">
    <input type="submit" class="button_active" value="Добавить нового сотрудника">
</form>

<div id="openModal" class="modalDialog">
    <div>
        <a href="#close" title="Закрыть" class="close">X</a>
        <h2>Модальное окно</h2>
        <p><input id="name_assoc" type="text" value="Введите Имя"/></p>
        <p><input id="last_name_assoc" type="text" value="Введите Фамилию"/></p>
        <p><select id="sel_prof">
        </select></p>
        <p><input id="inp_salary" type="number" value="Введите Зп"/></p>
        <p><input id="avatar" type="file" value="Укажите адресс на фото"/></p>
        <a id="close" title="Закрыть" href="#close">Добавить</a>
    </div>
</div>


<div id="radio_cl">
    <p><input class="ch_currency" name="ch_currency" type="radio" value="Rub" checked>Rub</p>
    <p><input class="ch_currency" name="ch_currency" type="radio" value="Usd">Usd</p>
</div>
<div id='gcw_mainFDtbXg6kP' class='gcw_mainFDtbXg6kP'></div>

<script>function reloadFDtbXg6kP() {
    var sc = document.getElementById('scFDtbXg6kP');
    if (sc) sc.parentNode.removeChild(sc);
    sc = document.createElement('script');
    sc.type = 'text/javascript';
    sc.charset = 'UTF-8';
    sc.async = true;
    sc.id = 'scFDtbXg6kP';
    sc.src = 'https://freecurrencyrates.com/ru/widget-horizontal?iso=USDRUB&df=2&p=FDtbXg6kP&v=i&source=cbr&width=220&width_title=110&firstrowvalue=1&thm=aaaaaa,C9C9C9,BBBBBB,dddddd,444444,cccccc,f8f8f8,3383BB,000000&title=%D0%9A%D0%BE%D0%BD%D0%B2%D0%B5%D1%80%D1%82%D0%B5%D1%80%20%D0%B2%D0%B0%D0%BB%D1%8E%D1%82&tzo=-180';
    var div = document.getElementById('gcw_mainFDtbXg6kP');
    div.parentNode.insertBefore(sc, div);
}
reloadFDtbXg6kP(); </script>


</body>
</html>